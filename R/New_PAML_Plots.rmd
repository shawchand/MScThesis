---
title: "PAML Plotting"
author: "Chandni Shaw Gupta"
date: "4/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(cowplot)  # For theme
library(lubridate)
library(ggsci)
library(ggrepel)
```

```{r}
library(ggplot2)
```

#M7 Site Model
```{r}
hist(rbeta(10^4, shape1 = 0.02627, shape2 = 0.39181))
```

#M8 Site Model
```{r}
M8 <- tibble(     proportion = c(0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.09861,  0.01390),
                  omega = c(0.00000,  0.00000,  0.00000,  0.00000,  0.00000,  0.00002,  0.00032,  0.00364,  0.03140,  0.23811,  3.46433))
knitr::kable(M8,align = "c",col.names = c("proportion","omega"))
```


#Taking dN/dS ratio on y-axis
```{r}
ggplot(data = M8) +
  geom_point(aes(x=proportion, y=omega), color = 'red') +
   geom_hline(yintercept = 1)+
  xlab("Proportion of sites") + 
  ylab("Selective pressure [dN/dS]") 
```


#Dotplot
```{r}
ggplot(data = M8, aes(x=omega)) +
  geom_dotplot(fill = 'red') + 
  xlab("Selective pressure [dN/dS]") + 
  ylab("Proportion of sites") 
```


```{r}
ggplot(data = M8, aes(x=omega)) +
  geom_density(kernel = "gaussian", color = 'red') + 
  xlab("Selective pressure [dN/dS]") + 
  ylab("Proportion of sites") 
```


#For visualiztion of sites and their estimated dN/dS ratio
```{r}
df<-read.table("C:/Users/awila/OneDrive/Documents/GitHub/MScThesis/R/bebsm.txt", sep = "")
```

```{r}
df$beb <- "No"
df$beb[df$V13 > 0.50] <- "Yes"
```

NOte: 3rd to 13th column = BEB score for each class (10 neutral + 1 allowing positive selection).


#geom_point presentation of whole S gene
```{r}
ggplot(df, aes(V1, V15)) +
  geom_point(aes(colour = factor(beb)))+
    geom_hline(yintercept = 1)+
   xlab("Amino acid position") +
     ylab("Selective pressure [dN/dS]") +
    ggtitle("Sites which have posterior probabilty > 50% of M8 Site Model") +
theme(legend.position = c(1,1),
        legend.justification = c(1,1))+
  NULL

ggsave("C:/Users/awila/OneDrive/Documents/GitHub/MScThesis/R/plots/bebsmpointwholeSgene.png", height=4, width=7)
```
Note: We see that most sites are under strong purifying selection and the sites under positive selection represent only a small fraction.


#geom_point presentation of RBD region
```{r}
 ggplot(df, aes(V1, V15)) +
  geom_point(aes(colour = factor(beb)))+
    geom_hline(yintercept = 1)+
   xlab("Amino acid position") +
     ylab("Selective pressure [dN/dS]") +
     xlim(c(451,510)) +
    ggtitle("Posterior probabilty > 50% of M8 Site Model for RBD region") +
theme(legend.position = c(1,1),
        legend.justification = c(1,1))+
  NULL

ggsave("C:/Users/awila/OneDrive/Documents/GitHub/MScThesis/R/plots/bebsmpointwholeSgene.png", height=4, width=7)
```


#geom_column presentation of whole S gene
```{r}
p <- ggplot(df, aes(V1, V15))
p + geom_col(aes(fill = factor(beb)))+
    geom_hline(yintercept = 1)+
   xlab("Amino acid position") +
     ylab("Selective pressure [dN/dS]") +
    ggtitle("Posterior probabilty > 50% of M8 Site Model") 
ggsave("C:/Users/awila/OneDrive/Documents/GitHub/MScThesis/R/plots/bebsmcolumnwholeSgene.png", height=4, width=7)
```

#geom_col presentation of RBD region
```{r}
p <- ggplot(df, aes(V1, V15))
p + geom_col(aes(fill = factor(beb)))+
    geom_hline(yintercept = 1)+
    xlab("Amino acid position") +
     ylab("Selective pressure [dN/dS]") +
    xlim(c(451,510)) +
    ggtitle("Posterior probabilty > 50% of M8 Site Model for RBD region") 
ggsave("C:/Users/awila/OneDrive/Documents/GitHub/MScThesis/R/plots/bebsmcolumnrbd.png", height=5, width=8)
```